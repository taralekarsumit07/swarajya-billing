<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SWARAJYA CARCARE Billing</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    body{
        font-family:Arial;
        margin:0;
        background:#f2f2f2;
        color:#333;
    }
    .container{
        max-width:900px;
        margin:auto;
        background:white;
        padding:20px;
        border-radius:10px;
        box-shadow:0 0 10px rgba(0,0,0,0.2);
        margin-top:20px;
    }
    .logo{
        width:200px;
        display:block;
        margin:0 auto 15px auto;
    }
    input,select,button{
        padding:8px;
        margin:5px 0;
        width:100%;
    }
    button{
        border:none;
        border-radius:5px;
        font-weight:bold;
        cursor:pointer;
    }
    .loginBtn{background:#ff9800;color:white;}
    .save{background:#4CAF50;color:white;}
    .print{background:#2196F3;color:white;}

    table{
        width:100%;
        border-collapse:collapse;
        margin-top:10px;
    }
    th,td{
        border:1px solid #ddd;
        padding:6px;
        text-align:center;
    }
    th{background:#f5f5f5;}

    @media print{
    button,input,select{display:none;}
    body::before{
    content:"";
    position:fixed;
    top:25%;
    left:20%;
    width:400px;
    height:400px;
    background:url('logo.png') no-repeat center;
    background-size:contain;
    opacity:0.06;
    z-index:-1;
    }
    }
  </style>
</head>

<body>

<div class="container" id="loginPage">
  <img src="logo.png" class="logo">
  <h2 style="text-align:center;">SWARAJYA CARCARE</h2>
  <h3>Login</h3>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button class="loginBtn" onclick="login()">Login</button>
</div>

<div class="container" id="billingPage" style="display:none;">
  <img src="logo.png" class="logo">
  <h2 style="text-align:center;">SWARAJYA CARCARE</h2>

  <p><b>Invoice No:</b> <span id="invoiceNo"></span></p>
  <p><b>Date:</b> <span id="date"></span></p>

  Customer:
  <input type="text" id="customer">


  Service:
  <select id="service" onchange="setPrice()">
    <option value="">-- Select Service --</option>
    <option value="60">Bike Wash Small - 60</option>
    <option value="80">Bike Wash Big - 80</option>
    <option value="150">Car Outside Cleaning - 150</option>
    <option value="300">Car Full Small - 300</option>
    <option value="350">Car Full Big - 350</option>
    <option value="100">Nitrogen Air - 100</option>
    <option value="30">Normal Air - 30</option>
    <option value="300">3D Alignment - 300</option>
    <option value="80">Tyre Balancing - 80</option>
    <option value="100">Puncture Simple - 100</option>
    <option value="300">Puncture Major - 300</option>
    <option value="600">Car Polishing 2W - 600</option>
    <option value="5999">Car Polishing 4W - 5999</option>
    <option value="2000">Ceramic Coating 2W - 2000</option>
    <option value="10000">Ceramic Coating 4W - 10000</option>
    <option value="3000">Graphene Coating 2W - 3000</option>
    <option value="29999">Graphene Coating 4W - 29999</option>
    <option value="3500">Brophine Coating 2W - 3500</option>
    <option value="14999">Brophine Coating 4W - 14999</option>
    <option value="other">Other</option>
  </select>

  Custom Service Name:
  <input type="text" id="customName" style="display:none;">

  Qty:
  <input type="number" id="qty" value="1">

  Price:
  <input type="number" id="price" readonly>

  <button onclick="addItem()">Add Item</button>

  <table>
    <thead>
    <tr><th>Service</th><th>Qty</th><th>Price</th><th>Total</th></tr>
    </thead>
    <tbody id="items"></tbody>
  </table>

  Discount (%):
  <input type="number" id="discount" value="0" oninput="updateTotal()">

  <h3>Grand Total: â‚¹<span id="grand">0</span></h3>

  <h3>Scan & Pay</h3>
  <div id="qrcode"></div>

  <button class="save" onclick="saveInvoice()">Save & Download Invoice</button>
  <button class="print" onclick="window.print()">Print</button>

</div>

<script>

  let subtotal=0;

  /* SERIAL INVOICE */
  function generateInvoiceNumber(){
    let last = parseInt(localStorage.getItem("invoiceSerial")) || 0;

    // ðŸ”¥ Double increment
    let next = last + 2;

    localStorage.setItem("invoiceSerial", next);

    return "INV" + String(next).padStart(4, "0");
}

  function login(){
  if(username.value==="admin" && password.value==="1234"){
  loginPage.style.display="none";
  billingPage.style.display="block";
  invoiceNo.innerText=generateInvoiceNumber();
  date.innerText=new Date().toLocaleString();
  }else{
  alert("Invalid Login");
  }
  }

  /* ENTER KEY LOGIN */
  document.addEventListener("keydown", function(e){
  if(e.key==="Enter" && loginPage.style.display!=="none"){
  login();
  }
  });

  function setPrice(){
  let value=service.value;
  if(value==="other"){
  customName.style.display="block";
  price.readOnly=false;
  price.value="";
  }else{
  customName.style.display="none";
  price.readOnly=true;
  price.value=value;
  }
  }

  function addItem(){
  let value=service.value;
  let name=value==="other"?customName.value:service.options[service.selectedIndex].text;
  let qty=parseFloat(document.getElementById("qty").value);
  let priceValue=parseFloat(document.getElementById("price").value);

  if(name===""||isNaN(qty)||isNaN(priceValue)){
  alert("Enter valid details");
  return;
  }

  let total=qty*priceValue;
  subtotal+=total;

  items.innerHTML+=`<tr>
  <td>${name}</td>
  <td>${qty}</td>
  <td>${priceValue}</td>
  <td>${total.toFixed(2)}</td>
  </tr>`;

  updateTotal();
  customName.value="";
  }

  function updateTotal(){
  let discountValue=parseFloat(document.getElementById("discount").value)||0;
  let grand=subtotal-(subtotal*(discountValue/100));
  document.getElementById("grand").innerText=grand.toFixed(2);
  generateQR(grand);
  }

  function generateQR(amount){
  let upiURL=`upi://pay?pa=7558382756@fam&pn=SWARAJYA CARCARE&am=${amount}&cu=INR`;
  qrcode.innerHTML="";
  new QRCode(qrcode,{text:upiURL,width:120,height:120});
  }

  function saveInvoice(){

  const { jsPDF } = window.jspdf;
  let doc=new jsPDF();

  let invoiceNumber=invoiceNo.innerText;
  let invoiceDate=date.innerText;
  let customerName=customer.value||"Walk-in Customer";
  let discountValue=parseFloat(discount.value)||0;
  let grandTotal=grand.innerText;

  let logo=new Image();
  logo.src="logo.png";

  logo.onload=function(){

  let imgWidth=logo.width;
  let imgHeight=logo.height;
  let ratio=imgHeight/imgWidth;

  let pdfWidth=80;
  let pdfHeight=pdfWidth*ratio;

  let pageWidth=doc.internal.pageSize.getWidth();
  let centerX=(pageWidth-pdfWidth)/2;

  doc.addImage(logo,"PNG",centerX,10,pdfWidth,pdfHeight);

  doc.setFontSize(18);
  doc.text("SWARAJYA CARCARE",pageWidth/2,pdfHeight+25,{align:"center"});

  doc.setFontSize(12);
  doc.text("Invoice No: "+invoiceNumber,20,pdfHeight+40);
  doc.text("Date: "+invoiceDate,20,pdfHeight+48);
  doc.text("Customer: "+customerName,20,pdfHeight+56);

  doc.line(20,pdfHeight+62,190,pdfHeight+62);

  let y=pdfHeight+72;

  doc.text("Service",20,y);
  doc.text("Qty",100,y);
  doc.text("Price",120,y);
  doc.text("Total",160,y);

  doc.line(20,y+2,190,y+2);
  y+=10;

  let rows=document.querySelectorAll("#items tr");
  rows.forEach(row=>{
  let cols=row.querySelectorAll("td");
  doc.text(cols[0].innerText,20,y);
  doc.text(cols[1].innerText,100,y);
  doc.text(cols[2].innerText,120,y);
  doc.text(cols[3].innerText,160,y);
  y+=8;
  });

  y+=5;
  doc.line(20,y,190,y);
  y+=10;

  doc.text("Discount: "+discountValue+"%",120,y);
  y+=8;

  doc.setFontSize(14);
  doc.text("Grand Total: â‚¹"+grandTotal,120,y);

  doc.save("Invoice_"+invoiceNumber+".pdf");

  };

  }

</script>

</body>
</html>