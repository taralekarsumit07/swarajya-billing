<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SWARAJYA CARCARE Billing</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    body{
        font-family:Arial;
        margin:0;
        background:#f2f2f2;
    }
    .container{
        max-width:900px;
        margin:auto;
        background:white;
        padding:20px;
        border-radius:10px;
        box-shadow:0 0 10px rgba(0,0,0,0.2);
        margin-top:20px;
    }
    .logo{
        width:200px;
        display:block;
        margin:0 auto 15px auto;
    }
    input,select,button{
        padding:8px;
        margin:5px 0;
        width:100%;
    }
    button{
        border:none;
        border-radius:5px;
        font-weight:bold;
        cursor:pointer;
    }
    .loginBtn{background:#ff9800;color:white;}
    .save{background:#4CAF50;color:white;}
    .print{background:#2196F3;color:white;}

    table{
        width:100%;
        border-collapse:collapse;
        margin-top:10px;
    }
    th,td{
        border:1px solid #ddd;
        padding:6px;
        text-align:center;
    }
    th{background:#f5f5f5;}

    @media print{
    button,input,select{display:none;}
    }
  </style>
</head>

<body>

<!-- LOGIN -->
<div class="container" id="loginPage">
  <img src="logo.png" class="logo">
  <h2 style="text-align:center;">SWARAJYA CARCARE</h2>
  <h3>Login</h3>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button class="loginBtn" onclick="login()">Login</button>
</div>

<!-- BILLING -->
<div class="container" id="billingPage" style="display:none;">

  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">

    <img src="logo.png" style="height:180px;">

    <div style="text-align:right;">
      <b style="font-size:20px;">SWARAJYA CARCARE</b><br>
      Shop No. 12, Market Road<br>
      Mumbai - 400001<br>
      Mo: 8983521107
    </div>

  </div>
  <hr>

  <p><b>Invoice No:</b> <span id="invoiceNo"></span></p>
  <p><b>Date:</b> <span id="date"></span></p>

  Customer:
  <input type="text" id="customer">

  Service:
  <select id="service" onchange="setPrice()">

    <option value="">-- Select Service --</option>

    <!-- Basic Services -->
    <option value="30">Tyre Balancing - 30</option>
    <option value="0">Car Outside Washing</option>
    <option value="0">Bike Wash</option>

    <!-- Car Cleaning -->
    <option value="30">8D Cleaning - 30</option>
    <option value="2200">Internal Cleaning - 2200</option>
    <option value="2000">External Cleaning - 2000</option>
    <option value="0">Engine Cleaning</option>
    <option value="2000">Glass Treatment - 2000</option>
    <option value="400">Water Spot Removal - 400</option>

    <!-- 2 Wheeler -->
    <option value="2000">Ceramic Coating (2W) - 2000</option>
    <option value="3000">Graphene Coating (2W) - 3000</option>
    <option value="3500">Graphene Premium (2W) - 3500</option>
    <option value="800">Polishing (2W) - 800</option>

    <!-- 4 Wheeler -->
    <option value="10000">Ceramic Coating (4W) - 10000</option>
    <option value="13000">Graphene Coating (4W) - 13000</option>
    <option value="15000">Graphene Premium (4W) - 15000</option>
    <option value="7000">Polishing (4W) - 7000</option>

    <!-- Puncture -->
    <option value="100">Puncture Simple - 100</option>
    <option value="300">Puncture Major - 300</option>

  </select>
  <div id="otherBox" style="display:none;">

    Service Name:
    <input type="text" id="otherName" placeholder="Enter Service Name">

    Price:
    <input type="number" id="otherPrice" placeholder="Enter Price">

  </div>



  Custom Service Name:
  <input type="text" id="customName" style="display:none;">

  Qty:
  <input type="number" id="qty" value="1">

  Price:
  <input type="number" id="price" readonly>

  <button onclick="addItem()">Add Item</button>
  <button onclick="clearAll()">Clear All</button>

  <table>
    <thead>
    <tr>
      <th>Service</th>
      <th>Qty</th>
      <th>Price</th>
      <th>Total</th>
      <th>Action</th>
    </tr>
    </thead>
    <tbody id="items"></tbody>
  </table>

  Discount (%):
  <input type="number" id="discount" value="0" oninput="updateTotal()">

  <h3>Grand Total: â‚¹<span id="grand">0</span></h3>

  <h3>Scan & Pay</h3>
  <div id="qrcode"></div>

  <p style="text-align:center;margin-top:30px;">
    <b>Thank You for Swarajya Carcare</b>
  </p>

  <button class="save" onclick="downloadPDF()">Save & Download Invoice</button>
  <button class="print" onclick="window.print()">Print</button>

</div>

<script>

 
  let subtotal = 0;

  /* ENTER KEY LOGIN */
  document.addEventListener("keydown", function(e){
      if(e.key === "Enter" && document.getElementById("loginPage").style.display !== "none"){
          login();
      }
  });

    /* INVOICE NUMBER */
    function generateInvoiceNumber(){
        let last = parseInt(localStorage.getItem("invoiceSerial")) || 0;
        let next = last + 1;
        localStorage.setItem("invoiceSerial", next);
        return "INV" + String(next).padStart(4,"0");
    }

    /* LOGIN */
    function login(){

      let user = document.getElementById("username").value.trim();
      let pass = document.getElementById("password").value.trim();

      if(user === "admin" && pass === "1234"){

          document.getElementById("loginPage").style.display = "none";
          document.getElementById("billingPage").style.display = "block";

          document.getElementById("invoiceNo").innerText = generateInvoiceNumber();
          document.getElementById("date").innerText = new Date().toLocaleString();

      }else{
          alert("Invalid Username or Password");
      }
  }

    /* DELETE ITEM */
    function deleteItem(btn,total){
        subtotal -= total;
        btn.parentElement.parentElement.remove();
        updateTotal();
    }

    /* EDIT ITEM */
    function editItem(btn){
        let row = btn.parentElement.parentElement;
        let cols = row.querySelectorAll("td");

        document.getElementById("qty").value = cols[1].innerText;
        document.getElementById("price").value = cols[2].innerText;

        subtotal -= parseFloat(cols[3].innerText);
        row.remove();
        updateTotal();
    }

    /* CLEAR ALL */
    function clearAll(){
        document.getElementById("items").innerHTML="";
        subtotal=0;
        updateTotal();
    }

    /* ADD ITEM */
    function addItem(){

        let serviceSelect = document.getElementById("service");
        let selectedValue = serviceSelect.value;

        let serviceName;
        let price;

        if(selectedValue === "other"){
            serviceName = document.getElementById("otherName").value;
            price = parseFloat(document.getElementById("otherPrice").value);
        }else{
            serviceName = serviceSelect.options[serviceSelect.selectedIndex].text;
            price = parseFloat(selectedValue);
        }

        let quantity = parseFloat(document.getElementById("qty").value);

        if(!serviceName || isNaN(price) || isNaN(quantity)){
            alert("Enter valid details");
            return;
        }

        let total = price * quantity;
        subtotal += total;

        let row = document.createElement("tr");
        row.innerHTML = `
            <td>${serviceName}</td>
            <td>${quantity}</td>
            <td>${price}</td>
            <td>${total.toFixed(2)}</td>
            <td>
                <button onclick="editItem(this)">Edit</button>
                <button onclick="deleteItem(this, ${total})">Delete</button>
            </td>
        `;

        document.getElementById("items").appendChild(row);

        updateTotal();
    }

    /* UPDATE TOTAL */
    function updateTotal(){
        let discountValue = parseFloat(document.getElementById("discount").value) || 0;
        let grand = subtotal - (subtotal*(discountValue/100));

        document.getElementById("grand").innerText = grand.toFixed(2);
        generateQR(grand);
    }

    /* QR GENERATE */
    function generateQR(amount){
        let upiURL=`upi://pay?pa=8983521107@okbizaxis&pn=SWARAJYA CARCARE&am=${amount}&cu=INR`;
        document.getElementById("qrcode").innerHTML="";
        new QRCode(document.getElementById("qrcode"),{
            text:upiURL,
            width:120,
            height:120
        });
    }

    /* PDF DOWNLOAD */
    function downloadPDF(){

        const { jsPDF } = window.jspdf;

        html2canvas(document.getElementById("billingPage"),{
            scale:3,
            useCORS:true
        }).then(canvas=>{

            const imgData = canvas.toDataURL("image/png");
            const pdf = new jsPDF("p","mm","a4");

            const imgWidth = 210;
            const imgHeight = canvas.height * imgWidth / canvas.width;

            pdf.addImage(imgData,"PNG",0,0,imgWidth,imgHeight);
            pdf.save("Invoice_"+document.getElementById("invoiceNo").innerText+".pdf");

        });
    }

    /* OTHER SERVICE BOX SHOW/HIDE */
    function handleServiceChange(){
        let selected = document.getElementById("service").value;

        if(selected === "other"){
            document.getElementById("otherBox").style.display="block";
        }else{
            document.getElementById("otherBox").style.display="none";
        }
    }

    function setPrice(){

  let serviceSelect = document.getElementById("service");
  let selectedValue = serviceSelect.value;

  if(selectedValue !== "other" && selectedValue !== ""){
      document.getElementById("price").value = selectedValue;
  }else{
      document.getElementById("price").value = "";
  }

  }
</script>

</body>
</html>
